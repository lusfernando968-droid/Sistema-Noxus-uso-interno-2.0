<!DOCTYPE html>
<html>
<head>
    <title>Teste de Inser√ß√£o - Bancos</title>
</head>
<body>
    <h1>Teste de Inser√ß√£o de Bancos</h1>
    <button onclick="testInsertBank()">Testar Inser√ß√£o de Banco</button>
    <button onclick="testPermissions()">Testar Permiss√µes</button>
    <div id="resultado"></div>

    <script>
        // Configura√ß√£o do Supabase (vamos usar o que est√° no projeto)
        const SUPABASE_URL = 'https://kkmnhpbbkkrkwbgnqxfy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrbW5ocGJia2tya3diZ25xeGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE0NTQxMzUsImV4cCI6MjA0NzAzMDEzNX0.1WQ3LVALE3q2W3fN3XaQhL3Xb3xZ3Y3Z3Y3Z3Y3Z3Y3Z';

        async function testPermissions() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>üîÑ Testando permiss√µes...</p>';
            
            try {
                // Testar se consegue ler a tabela
                const response = await fetch(`${SUPABASE_URL}/rest/v1/bancos?select=id&limit=1`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (response.ok) {
                    resultado.innerHTML += '<p>‚úÖ Permiss√£o de leitura: OK</p>';
                } else {
                    resultado.innerHTML += `<p>‚ùå Permiss√£o de leitura: ${response.status} - ${response.statusText}</p>`;
                }
                
            } catch (error) {
                resultado.innerHTML += `<p>‚ùå Erro ao testar permiss√µes: ${error.message}</p>`;
            }
        }

        async function testInsertBank() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>üîÑ Iniciando teste de inser√ß√£o...</p>';
            
            const testBank = {
                nome_curto: "Banco Teste Debug",
                nome: "Banco Teste Debug S.A.",
                codigo: "998",
                cor_primaria: "#FF0000",
                ativo: true
            };
            
            resultado.innerHTML += `<p>üìä Dados do teste: ${JSON.stringify(testBank)}</p>`;
            
            try {
                // Tentar inserir
                const response = await fetch(`${SUPABASE_URL}/rest/v1/bancos`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(testBank)
                });
                
                const responseText = await response.text();
                resultado.innerHTML += `<p>üì° Status: ${response.status} - ${response.statusText}</p>`;
                resultado.innerHTML += `<p>üìÑ Resposta: ${responseText}</p>`;
                
                if (response.ok) {
                    resultado.innerHTML += '<p>‚úÖ Banco inserido com sucesso!</p>';
                } else {
                    resultado.innerHTML += '<p>‚ùå Erro na inser√ß√£o</p>';
                    
                    // Analisar erro comum
                    if (response.status === 401) {
                        resultado.innerHTML += '<p>üö´ Erro de autentica√ß√£o - verifique a API key</p>';
                    } else if (response.status === 403) {
                        resultado.innerHTML += '<p>üö´ Erro de permiss√£o (RLS) - verifique as regras de seguran√ßa</p>';
                    } else if (response.status === 409) {
                        resultado.innerHTML += '<p>‚ö†Ô∏è Conflito - c√≥digo de banco j√° existe</p>';
                    } else if (response.status === 400) {
                        resultado.innerHTML += '<p>üìã Erro de valida√ß√£o - campo obrigat√≥rio faltando</p>';
                    }
                }
                
            } catch (error) {
                resultado.innerHTML += `<p>‚ùå Erro geral: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>